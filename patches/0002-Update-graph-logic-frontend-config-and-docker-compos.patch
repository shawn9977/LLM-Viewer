From dd055e7dd713368dbce33ca040d8dfe9c8b8abbc Mon Sep 17 00:00:00 2001
From: shawn9977 <shawn@rtx4090d.bj.intel.com>
Date: Thu, 5 Feb 2026 14:36:24 +0800
Subject: [PATCH 2/7] Update graph logic, frontend config and docker-compose

---
 backend/get_model_graph.py                       | 9 +++++++--
 docker-compose.yml                               | 2 +-
 frontend/src/components/Header.vue               | 1 +
 frontend/src/components/left_controls/Config.vue | 4 ++++
 4 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/backend/get_model_graph.py b/backend/get_model_graph.py
index ee0bc6f..01d48dc 100644
--- a/backend/get_model_graph.py
+++ b/backend/get_model_graph.py
@@ -78,8 +78,13 @@ def get_model_graph(model_id, hardware, inference_config):
     if stage == "vision":
         if use_flashattention and hasattr(analyzer.module, "vision_flashattention_layer_graph"):
             layer_graph = analyzer.module.vision_flashattention_layer_graph
-        else:
+        elif hasattr(analyzer.module, "vision_layer_graph"):
             layer_graph = analyzer.module.vision_layer_graph
+        else:
+            # Fallback for non-VLM models when vision stage is selected
+            stage = "prefill"
+            input_node_id = "input"
+            layer_graph = analyzer.module.transformer_layer_graph
     elif use_flashattention:
         layer_graph = analyzer.module.flashattention_transformer_layer_graph
     else:
@@ -91,7 +96,7 @@ def get_model_graph(model_id, hardware, inference_config):
         result = result["prefill"]
 
     for name, input_names in layer_graph.items():
-        if name in ["input", "output"]:
+        if name in ["input", "output", "vision_input"] or name not in result:
             OPs = 0
             memory_access = 0
             info = {}
diff --git a/docker-compose.yml b/docker-compose.yml
index 9a06048..e8a7f84 100644
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -7,7 +7,7 @@ services:
       dockerfile: Dockerfile
     working_dir: /app
     environment:
-      - VITE_IP_PORT=172.16.112.118:5000
+      - VITE_IP_PORT=172.16.112.18:5000
       - VITE_MODEL_ID=Qwen/Qwen3-4B-Instruct-2507
       - VITE_HARDWARE=intel_ARC_B60
     depends_on:
diff --git a/frontend/src/components/Header.vue b/frontend/src/components/Header.vue
index 2ba47d6..f254dbb 100644
--- a/frontend/src/components/Header.vue
+++ b/frontend/src/components/Header.vue
@@ -21,6 +21,7 @@
         <select v-model="ip_port">
             <option value="172.16.112.46:5000">172.16.112.46</option>
             <option value="172.16.112.118:5000">172.16.112.118</option>
+            <option value="172.16.112.18:5000">172.16.112.18</option>
             <option value="127.0.0.1:5000">localhost</option>
         </select>
     </div>
diff --git a/frontend/src/components/left_controls/Config.vue b/frontend/src/components/left_controls/Config.vue
index d27aad9..fce23ba 100644
--- a/frontend/src/components/left_controls/Config.vue
+++ b/frontend/src/components/left_controls/Config.vue
@@ -17,6 +17,10 @@
         <input type="number" v-model.lazy="batch_size" min="1" max="256">
     </div>
     <div class="config_div" v-if="inference_stage=='vision'">
+        SeqLength:
+        <input type="range" min="1" max="4096" value="1024" v-model.lazy="seq_length">
+        <input type="number" v-model.lazy="seq_length" min="1" max="4096">
+        <br/>
         Image Size:
         <input type="number" v-model.lazy="image_width" min="1" max="8192">
         <span> x </span>
-- 
2.34.1

